close all;
clear;
clear global;

data = readmatrix("test3.csv");

figure_count = 0;

num_points = 17;
points = zeros(3, num_points);

previous_estimate = [3; 2; -1];

%angle from correct
poses = data(1:num_points, 4:10)';
delta_s = data(1:num_points, 3)' * 1500;

poses = [ -0.1654   -0.0052    0.4661    0.7436    0.6187    0.0037   -0.7318   -1.0728   -1.1343   -1.1684   -1.1649   -1.0534   -0.5775   -0.3561   -0.2073
    0.2949    0.2951    0.2949    0.2953    0.2943    0.2950    0.2949    0.2947    0.4725    0.6550    0.7949    0.7661    0.7213    0.6777    0.6443
   -0.9838   -0.9904   -0.9953   -0.9834   -0.9783   -0.9680   -0.9589   -0.9779   -0.9800   -0.9807   -0.9881   -0.9903   -0.9986   -0.9937   -0.9825
    1.0000    0.9999    0.9995    1.0000    0.9999    0.9986    0.9969    0.9998    0.9999    0.9999    1.0000    1.0000    0.9994    0.9999    1.0000
    0.0025    0.0024    0.0026    0.0024    0.0025    0.0025    0.0021    0.0024    0.0085    0.0113    0.0024   -0.0005   -0.0030   -0.0034   -0.0012
   -0.0002   -0.0102   -0.0325    0.0062    0.0157    0.0537    0.0787    0.0179    0.0098    0.0038   -0.0023   -0.0080   -0.0340   -0.0144    0.0077
    0.0001    0.0002   -0.0001   -0.0007    0.0007   -0.0004    0.0003    0.0004   -0.0002   -0.0004    0.0004   -0.0003    0.0006    0.0009    0.0011]

delta_s = [       -0.3577
   -0.3703
   -0.4121
   -0.4407
   -0.4273
   -0.3727
   -0.3183
   -0.2975
   -0.2748
   -0.2505
   -0.2323
   -0.2420
   -0.2728
   -0.2932
   -0.3080]

for i = 1:100
    previous_estimate = estimate_pinger_position(poses, delta_s, previous_estimate, [-.01; .65; 0])
    %previous_estimate(3) = -1;
    disp(i);
end
